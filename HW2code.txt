Option Explicit

Sub homework()
    'Dim current As Worksheets
    'Dim starting_ws As Worksheet
    'Set starting_ws = ActiveSheet
    
    'For Each current In ActiveWorkbook.Worksheets
      ' current.Activate
            
        Dim row As Long
        Dim col As Integer
        Dim lastrow As Long
        Dim tickercounter As Integer
        Dim totvol As Double
        Dim totopen As Double
        Dim totclose As Double
        
        Dim yearlychange As Double
        Dim percentchange As Double
        
        
        lastrow = Cells(Rows.Count, 1).End(xlUp).row
        
        Cells(1, 9) = "Tickers"
        Cells(1, 10) = "Total Volume"
        Cells(1, 11) = "Yearly Change"
        Cells(1, 12) = "Percent Change"
        
        
        tickercounter = 2
        totopen = Cells(2, 3)
        
        For row = 2 To lastrow
            If Cells(row, 1) <> Cells(row + 1, 1) Then
                
                totclose = Cells(row, 6)
                yearlychange = totclose - totopen
                percentchange = yearlychange / totopen
                totvol = totvol + Cells(row, 7)
                Cells(tickercounter, 11) = yearlychange
                Cells(tickercounter, 12) = percentchange
                Cells(tickercounter, 12).NumberFormat = "0.00%"
                Cells(tickercounter, 9) = Cells(row, 1)
                Cells(tickercounter, 10) = totvol
                If yearlychange < 0 Then
                    Cells(tickercounter, 11).Interior.ColorIndex = 3
                Else
                    Cells(tickercounter, 11).Interior.ColorIndex = 4
                End If
                
                totopen = Cells(row + 1, 3)
                totvol = 0
                tickercounter = tickercounter + 1
                            
            Else
                totvol = totvol + Cells(row, 7)
            End If
        Next row
        
        
        lastrow = Cells(Rows.Count, 12).End(xlUp).row
        Dim increase As Double
        Dim decrease As Double
        Dim increaseticker As String
        Dim decreaseticker As String
        Dim volticker As String
        
        increase = Cells(2, 12)
        decrease = Cells(2, 12)
        totvol = Cells(2, 10)
        increaseticker = Cells(2, 9)
        decreaseticker = Cells(2, 9)
            
        For row = 2 To lastrow
            If Cells(row, 12) < decrease Then
                decrease = Cells(row, 12)
                decreaseticker = Cells(row, 9)
                
            ElseIf Cells(row, 12) > increase Then
                increase = Cells(row, 12)
                increaseticker = Cells(row, 9)
            End If
            
            If Cells(row, 10) > totvol Then
               totvol = Cells(row, 10)
               volticker = Cells(row, 9)
            End If
        Next row
        
        Cells(2, 14) = "Greatest % Increase"
        Cells(3, 14) = "Greatest % Decrease"
        Cells(4, 14) = "Greatest Total Volume"
        Cells(1, 15) = "Ticker"
        Cells(1, 16) = "Value"
        Range("1:1").Font.Bold = True
        
        Cells(2, 14).Font.Bold = True
        Cells(3, 14).Font.Bold = True
        Cells(4, 14).Font.Bold = True
        
        Cells(2, 15) = increaseticker
        Cells(2, 16) = increase
        Cells(2, 16).NumberFormat = "0.00%"
        Cells(3, 15) = decreaseticker
        Cells(3, 16) = decrease
        Cells(3, 16).NumberFormat = "0.00%"
        Cells(4, 15) = volticker
        Cells(4, 16) = totvol
        'MsgBox current.Name
    
    'Next current
    
    'starting_ws.Activate
    
End Sub